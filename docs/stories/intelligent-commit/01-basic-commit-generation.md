# 用户故事: 基础提交信息生成

## 故事描述

**作为一个**开发者  
**我希望**使用 `gitai commit` 命令自动生成高质量的提交信息  
**以便于**我能够快速创建清晰、规范的 Git 提交记录，提高开发效率

## 验收标准

### AC1: 基本命令支持
- **给定**我在一个有未提交更改的 Git 仓库中
- **当**我执行 `gitai commit` 或 `gitai cm` 命令
- **那么**系统应该自动分析 git diff 信息并生成提交信息

### AC2: AI 提交信息生成
- **给定**系统检测到文件更改
- **当**系统调用 AI 服务生成提交信息时
- **那么**应该使用 `commit-generator.md` 中定义的 prompt 模板
- **并且**生成的提交信息应该遵循标准的提交信息格式

### AC3: 与标准 Git 兼容
- **给定**生成的提交信息
- **当**用户确认提交时
- **那么**系统应该调用标准的 `git commit` 命令完成提交
- **并且**保持与原生 Git 工作流的兼容性

### AC4: 错误处理
- **给定**仓库没有可提交的更改
- **当**用户执行 `gitai commit` 命令时
- **那么**系统应该显示友好的错误信息
- **并且**退出码应该与 `git commit` 保持一致

## 技术要求

### 命令行处理
- 解析 `commit` 和 `cm` 子命令
- 检测当前目录是否为有效的 Git 仓库
- 获取 git diff 信息用于 AI 分析

### AI 集成
- 从配置中加载 commit-generator.md 模板
- 将 git diff 信息作为上下文传递给 AI 服务
- 处理 AI 服务的响应和错误情况

### Git 操作
- 调用 `git status` 检查仓库状态
- 获取 `git diff --cached` 或 `git diff HEAD` 信息
- 执行最终的 `git commit` 操作

## 实现细节

### 命令流程
1. 检测命令行参数中的 `commit` 或 `cm`
2. 验证当前工作目录为 Git 仓库
3. 检查是否有可提交的更改
4. 获取 git diff 信息
5. 调用 AI 服务生成提交信息
6. 显示生成的提交信息供用户确认
7. 执行 git commit 命令

### 配置依赖
- `AppConfig` 中的 AI 服务配置
- `commit-generator.md` 模板文件
- Git 仓库的基本信息

### 错误场景处理
- 非 Git 仓库目录
- 没有可提交的更改
- AI 服务调用失败
- 网络连接问题
- Git 命令执行失败

## 完成定义

- [ ] 实现基本的命令行参数解析
- [ ] 添加 Git 仓库状态检查
- [ ] 集成 AI 服务调用逻辑
- [ ] 实现提交信息生成和确认流程
- [ ] 添加错误处理和用户友好的提示信息
- [ ] 编写单元测试覆盖主要功能
- [ ] 编写集成测试验证端到端流程
- [ ] 更新文档说明基本用法

## 相关依赖

- 配置系统 (config.rs)
- AI 客户端 (clients/*)
- Git 工具函数 (utils/git.rs)
- 错误处理系统 (errors.rs)

## 优先级

**高** - 这是智能提交功能的核心基础，其他功能都依赖于此故事的完成

## 估算

**开发工作量**: 3-5 个开发日  
**测试工作量**: 2-3 个开发日