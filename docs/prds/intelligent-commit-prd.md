# GitAI 智能提交功能产品需求文档 (PRD)

## 1. 产品概述

### 1.1 功能描述
GitAI 智能提交功能旨在为开发者提供智能化的 Git 提交体验，通过结合静态代码分析(Tree-sitter)、Git diff 信息和 AI 技术，自动生成高质量的提交信息，同时支持与代码审查结果的集成。

### 1.2 目标用户
- 需要频繁进行代码提交的开发者
- 希望提高提交信息质量的团队
- 需要结构化代码分析的项目维护者

## 2. 核心功能需求

### 2.1 基础提交功能
- **命令格式**: `gitai commit` 或 `gitai cm`
- **默认行为**: 基于 git diff 信息使用 AI 生成提交信息
- **AI 提示模板**: 使用 `commit-generator.md` 中定义的 prompt 模板

### 2.2 Tree-sitter 增强分析
- **启用参数**: `-t` 或 `--tree-sitter`
- **分析级别**: `-l` 或 `--level` 参数控制分析深度
- **分析流程**:
  1. 对项目进行 Tree-sitter 静态分析
  2. 结合 git diff 信息
  3. 生成更精准的 AI 提交信息

### 2.3 代码审查集成
- **审查结果存储**:
  - 默认路径: `~/.gitai/review_results/repo_name/review_commitID.md`
  - 支持用户自定义存储路径
- **集成流程**:
  1. 检测是否存在相关的 review 结果
  2. 将 review 内容作为上下文参与 commit 信息生成
  3. 在生成的 commit 信息中引用相关的 review 要点

### 2.4 用户自定义提交信息支持
- **参数支持**: `-m` 参数允许用户输入自定义提交信息
- **混合模式**:
  - 保留用户原始提交信息
  - AI 生成的信息作为独立章节展示
  - 提供建议性的改进内容

### 2.5 智能暂存支持
- **参数支持**: `commit -a` 形式的提交
- **行为**: 自动执行 `git add` 操作后进行智能提交

## 3. 技术架构需求

### 3.1 命令行参数解析
- 支持短参数和长参数形式
- 参数优先级和冲突处理
- 向后兼容标准 git commit 参数

### 3.2 静态分析集成
- Tree-sitter 分析器集成
- 可配置的分析级别
- 性能优化和缓存机制

### 3.3 AI 生成服务
- 基于配置的 AI 服务选择
- Prompt 模板管理
- 上下文信息整合

### 3.4 文件系统操作
- 审查结果的读写操作
- 目录结构的自动创建
- 权限和安全性考虑

## 4. 用户体验需求

### 4.1 性能要求
- Tree-sitter 分析响应时间 < 5秒 (中型项目)
- AI 生成响应时间 < 10秒
- 整体命令执行时间 < 15秒

### 4.2 输出格式
- 清晰的进度提示
- 结构化的提交信息展示
- 错误信息的友好提示

### 4.3 交互设计
- 支持交互式确认模式
- 提供提交信息的预览功能
- 允许用户编辑生成的提交信息

## 5. 配置和定制

### 5.1 配置项
- Tree-sitter 分析的默认级别
- 审查结果存储路径
- AI 生成的详细程度
- 输出格式偏好设置

### 5.2 模板定制
- 支持自定义 commit message 模板
- 多语言提交信息支持
- 团队/项目级别的模板共享

## 6. 错误处理和边界情况

### 6.1 错误场景
- Git 仓库状态异常
- Tree-sitter 分析失败
- AI 服务不可用
- 网络连接问题

### 6.2 降级策略
- Tree-sitter 分析失败时回退到基础模式
- AI 服务不可用时提供模板填充
- 保持与原生 git commit 的兼容性

## 7. 安全和隐私

### 7.1 数据安全
- 代码内容的本地处理优先
- AI 服务调用时的数据脱敏
- 审查结果的访问权限控制

### 7.2 隐私保护
- 敏感信息过滤
- 可配置的数据上传范围
- 审计日志记录

## 8. 成功指标

### 8.1 功能指标
- 命令执行成功率 > 95%
- 生成的提交信息质量评分 > 4/5
- Tree-sitter 分析准确率 > 90%

### 8.2 用户体验指标
- 用户采用率 > 70%
- 平均使用频率提升 > 50%
- 用户满意度 > 4/5

## 9. 发布计划

### 9.1 MVP 版本
- 基础 AI 提交信息生成
- Tree-sitter 集成
- 基本参数支持

### 9.2 增强版本
- 审查集成功能
- 高级配置选项
- 性能优化

### 9.3 完整版本
- 完整的用户体验优化
- 全面的错误处理
- 文档和测试覆盖
