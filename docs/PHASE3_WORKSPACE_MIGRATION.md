# Phase 3: GitAI Workspace æ¶æ„è¿ç§»è®¡åˆ’

> ARCHIVED: Migration plan retained for reference. For the current workspace layout see Cargo.toml and docs/architecture/ARCHITECTURE.md.

## æ¦‚è¿°

å°† GitAI ä»å•ä½“åº”ç”¨é‡æ„ä¸ºå¤š crate workspace æ¶æ„ï¼Œæé«˜æ¨¡å—åŒ–ç¨‹åº¦ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚

## ç›®æ ‡æ¶æ„

```
gitai/
â”œâ”€â”€ Cargo.toml (workspace root)
â”œâ”€â”€ crates/
â”‚   â”œâ”€â”€ gitai-core/       # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œé›¶å¤–éƒ¨ä¾èµ–
â”‚   â”œâ”€â”€ gitai-types/      # å…±äº«ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ gitai-analysis/   # ä»£ç åˆ†æå¼•æ“ï¼ˆTree-sitter ç­‰ï¼‰
â”‚   â”œâ”€â”€ gitai-security/   # å®‰å…¨æ‰«æåŠŸèƒ½
â”‚   â”œâ”€â”€ gitai-metrics/    # åº¦é‡å’Œç›‘æ§
â”‚   â”œâ”€â”€ gitai-cli/        # å‘½ä»¤è¡Œæ¥å£
â”‚   â””â”€â”€ gitai-mcp/        # MCP æœåŠ¡å™¨
â”œâ”€â”€ src/                  # ä¿ç•™ç”¨äºé›†æˆæµ‹è¯•
â””â”€â”€ tests/               # é›†æˆæµ‹è¯•
```

## è¿ç§»æ­¥éª¤

### ç¬¬ä¸€é˜¶æ®µï¼šå‡†å¤‡å·¥ä½œï¼ˆå½“å‰ï¼‰

1. **åˆ›å»º workspace ç»“æ„** âœ…
   - crates ç›®å½•å·²å­˜åœ¨
   - å„ä¸ª crate ç›®å½•å·²åˆ›å»º
   - Cargo.toml æ–‡ä»¶å·²å‡†å¤‡

2. **åˆ†æä¾èµ–å…³ç³»**
   - è¯†åˆ«æ ¸å¿ƒåŠŸèƒ½å’Œå¤–éƒ¨ä¾èµ–
   - åˆ›å»ºä¾èµ–å…³ç³»å›¾
   - ç¡®å®šè¿ç§»é¡ºåº

### ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒæ¨¡å—æå–

1. **gitai-types**
   - æå–æ‰€æœ‰å…±äº«ç±»å‹å®šä¹‰
   - åŒ…æ‹¬ domain/entities
   - ç¡®ä¿é›¶å¤–éƒ¨ä¾èµ–

2. **gitai-core**
   - æå–æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
   - åŒ…æ‹¬ domain/interfaces
   - æœ€å°åŒ–å¤–éƒ¨ä¾èµ–

3. **gitai-analysis**
   - æå– tree_sitter æ¨¡å—
   - æå– analysis.rs
   - ä¿æŒè¯­è¨€è§£æå™¨çš„å¯é€‰æ€§

### ç¬¬ä¸‰é˜¶æ®µï¼šåŠŸèƒ½æ¨¡å—æå–

1. **gitai-security**
   - æå– scan.rs å’Œç›¸å…³åŠŸèƒ½
   - OpenGrep é›†æˆ
   - å®‰å…¨è§„åˆ™ç®¡ç†

2. **gitai-metrics**
   - æå– metrics/ æ¨¡å—
   - è´¨é‡æŒ‡æ ‡è·Ÿè¸ª
   - æ€§èƒ½ç›‘æ§

### ç¬¬å››é˜¶æ®µï¼šæ¥å£å±‚æå–

1. **gitai-cli**
   - æå– cli/ æ¨¡å—
   - å‘½ä»¤å¤„ç†å™¨
   - ç”¨æˆ·äº¤äº’é€»è¾‘

2. **gitai-mcp**
   - æå– mcp/ æ¨¡å—
   - MCP æœåŠ¡å®ç°
   - æœåŠ¡æ³¨å†Œè¡¨

### ç¬¬äº”é˜¶æ®µï¼šé›†æˆå’Œæµ‹è¯•

1. **æ›´æ–°ä¸» Cargo.toml**
   - è½¬æ¢ä¸º workspace é…ç½®
   - å®šä¹‰å…±äº«ä¾èµ–
   - è®¾ç½®æ„å»ºé…ç½®

2. **æ›´æ–°æµ‹è¯•**
   - è¿ç§»å•å…ƒæµ‹è¯•åˆ°å„ä¸ª crate
   - ä¿ç•™é›†æˆæµ‹è¯•åœ¨æ ¹ç›®å½•
   - æ·»åŠ  crate é—´é›†æˆæµ‹è¯•

3. **æ›´æ–°æ–‡æ¡£å’Œ CI**
   - æ›´æ–°æ„å»ºè„šæœ¬
   - æ›´æ–° CI/CD é…ç½®
   - åˆ›å»ºè¿ç§»æŒ‡å—

## ä¾èµ–å…³ç³»çŸ©é˜µ

| Crate | ä¾èµ–çš„ Crates | ä¸»è¦åŠŸèƒ½ |
|-------|--------------|---------|
| gitai-types | - | å…±äº«ç±»å‹å®šä¹‰ |
| gitai-core | gitai-types | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ |
| gitai-analysis | gitai-types, gitai-core | ä»£ç åˆ†æ |
| gitai-security | gitai-types, gitai-core | å®‰å…¨æ‰«æ |
| gitai-metrics | gitai-types, gitai-core | åº¦é‡ç³»ç»Ÿ |
| gitai-cli | æ‰€æœ‰ crates | CLI æ¥å£ |
| gitai-mcp | æ‰€æœ‰ crates | MCP æœåŠ¡ |

## é£é™©å’Œç¼“è§£æªæ–½

### é£é™©
1. **ç ´åç°æœ‰åŠŸèƒ½**
   - ç¼“è§£ï¼šæ¸è¿›å¼è¿ç§»ï¼Œä¿æŒæµ‹è¯•è¦†ç›–

2. **ä¾èµ–å¾ªç¯**
   - ç¼“è§£ï¼šæ¸…æ™°çš„å±‚æ¬¡ç»“æ„ï¼Œtypes åœ¨æœ€åº•å±‚

3. **æ„å»ºæ—¶é—´å¢åŠ **
   - ç¼“è§£ï¼šå¹¶è¡Œæ„å»ºï¼Œåˆç†çš„ crate ç²’åº¦

## æˆåŠŸæ ‡å‡†

1. **åŠŸèƒ½å®Œæ•´æ€§**
   - æ‰€æœ‰ç°æœ‰æµ‹è¯•é€šè¿‡
   - åŠŸèƒ½æ— å›å½’

2. **æ¶æ„è´¨é‡**
   - æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œ
   - æœ€å°åŒ–çš„ä¾èµ–è€¦åˆ
   - æ”¹è¿›çš„æ„å»ºæ—¶é—´

3. **å¼€å‘ä½“éªŒ**
   - æ›´å®¹æ˜“çš„å•å…ƒæµ‹è¯•
   - æ›´å¥½çš„ä»£ç ç»„ç»‡
   - ç®€åŒ–çš„ç»´æŠ¤æµç¨‹

## è¿›åº¦è·Ÿè¸ª

- [x] ç¬¬ä¸€é˜¶æ®µï¼šå‡†å¤‡å·¥ä½œ âœ…
  - åˆ›å»º workspace ç»“æ„
  - åˆ†æä¾èµ–å…³ç³»
  - è®¾ç½®åŸºæœ¬çš„ crate æ¡†æ¶
  
- [x] ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒæ¨¡å—æå–ï¼ˆéƒ¨åˆ†å®Œæˆï¼‰
- [x] gitai-typesï¼šæå–æ‰€æœ‰å…±äº«ç±»å‹å®šä¹‰ âœ…
    - common.rsï¼šæ ¸å¿ƒå®ä½“ï¼ˆFilePath, Language, Version ç­‰ï¼‰
    - risk.rsï¼šSeverity å’Œ RiskLevel ç±»å‹
    - error.rsï¼šç»Ÿä¸€é”™è¯¯ç±»å‹
    - change.rsï¼šç ´åæ€§å˜æ›´ç±»å‹
- [x] gitai-coreï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ âœ…
    - domain/interfaces å’Œ domain/services è¿ç§»å®Œæˆ
    - æ ¸å¿ƒé…ç½®ã€Gitã€DevOps åŠŸèƒ½æ­£å¸¸å·¥ä½œ
    - æ‰€æœ‰ç¼–è¯‘é”™è¯¯å·²ä¿®å¤
  - [x] gitai-analysisï¼šä»£ç åˆ†æåŠŸèƒ½ âœ…
    - tree_sitter æ¨¡å—æˆåŠŸè¿ç§»
    - architectural_impact æ¨¡å—æˆåŠŸè¿ç§»
    - analysis.rs åŠŸèƒ½æˆåŠŸè¿ç§»
    - utils æ¨¡å—æˆåŠŸè¿ç§»
    - ä¿®å¤äº† GitError ç±»å‹ä½¿ç”¨é—®é¢˜
    - æ‰€æœ‰ç¼–è¯‘é”™è¯¯å·²è§£å†³
  
- [ ] ç¬¬ä¸‰é˜¶æ®µï¼šåŠŸèƒ½æ¨¡å—æå–
- [ ] ç¬¬å››é˜¶æ®µï¼šæ¥å£å±‚æå–
- [ ] ç¬¬äº”é˜¶æ®µï¼šé›†æˆå’Œæµ‹è¯•

## å½“å‰çŠ¶æ€

### âœ… å·²å®Œæˆ
- Workspace åŸºç¡€é…ç½®
- gitai-types crate å®Œå…¨è¿ç§»å¹¶å¯ç¼–è¯‘
- gitai-core crate è¿ç§»å¹¶å¯ç¼–è¯‘
- gitai-analysis crate è¿ç§»å¹¶å¯ç¼–è¯‘
- ä¾èµ–å…³ç³»åˆ†æå·¥å…·

### ğŸš§ è¿›è¡Œä¸­
- gitai-security crate è¿ç§»ï¼ˆä¸‹ä¸€æ­¥ï¼‰

### ğŸ“ å¾…å¤„ç†
- å…¶ä»– crate çš„è¿ç§»
- é›†æˆæµ‹è¯•æ›´æ–°
- CI/CD é…ç½®æ›´æ–°

æœ€åæ›´æ–°ï¼š2025-01-11
