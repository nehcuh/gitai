# GitAI æ¶æ„æ¦‚è§ˆï¼ˆå½“å‰çŠ¶æ€ï¼‰

ç‰ˆæœ¬èŒƒå›´ï¼šv0.1.xï¼ˆæœ¬ä»“åº“ç°çŠ¶ï¼‰ï¼Œç›®æ ‡æ˜¯â€œé›¶ç ´åã€å¯ç”¨ä¸ºå…ˆâ€ï¼Œé¿å…æ–‡æ¡£ä¸å®ç°æ¼‚ç§»ã€‚

## 1. æ¨¡å—ä¸èŒè´£

- src/main.rs
  - å¯åŠ¨ã€è§£æ CLIã€åŠ è½½é…ç½®ã€è·¯ç”±åˆ°å„å­å‘½ä»¤
- src/args.rs
  - CLI å‚æ•°å®šä¹‰ï¼ˆReview/Scan/ScanHistory/Prompts/Commit/Update/Git ä»£ç†ï¼‰
- src/config.rs
  - é…ç½®ç»“æ„ä½“ä¸åŠ è½½ï¼ˆ~/.config/gitai/config.tomlï¼‰
- src/git.rs
  - Git å­è¿›ç¨‹å°è£…ï¼ˆrun_gitã€diff/status/add/commitï¼‰ï¼Œç¦ç”¨ pager ä¿è¯éäº¤äº’ç¨³å®š
- src/scan.rs
  - OpenGrep é›†æˆï¼šè§„åˆ™ç›®å½•é€‰æ‹©ï¼ˆ--lang ä¼˜å…ˆ/è‡ªåŠ¨æ£€æµ‹ä½œä¸ºåå¤‡ï¼‰ã€æ„å»ºå‘½ä»¤ã€è¿è¡Œä¸ JSON è§£æã€æ‰«æå†å²æŒä¹…åŒ–ã€å®‰è£…å¸®åŠ©
- src/review.rs
  - è¯„å®¡ä¸»æµç¨‹ï¼šè·å– diff â†’ æš‚å­˜æç¤º â†’ ç¼“å­˜ â†’ è·å– Issue ä¸Šä¸‹æ–‡ â†’ è°ƒç”¨ Analyzer â†’ ä¿å­˜ç¼“å­˜ â†’ è¾“å‡ºï¼ˆå¯é˜»æ–­ä¸¥é‡é—®é¢˜ï¼‰
- src/analysis.rs
  - Analyzerï¼š
    - analyze_reviewï¼šç»„è£… prompt è°ƒç”¨ AIï¼ˆå½“å‰ä¸å« Treeâ€‘sitter ç»“æ„åŒ–æ‘˜è¦ï¼‰
    - analyze_securityï¼šæŒ‰éœ€è°ƒç”¨ scan è¿›è¡Œå®‰å…¨æ‰«æï¼ˆOpenGrepï¼‰
    - analyze_deviationï¼šæ ¹æ® Issue ä¸Šä¸‹æ–‡åšåç¦»åº¦æŠ¥å‘Šï¼ˆAIï¼‰
- src/commit.rs
  - æ™ºèƒ½æäº¤ï¼šæ”¶é›† diff/Issue â†’ ç”Ÿæˆæäº¤ä¿¡æ¯ï¼ˆæˆ–ä½¿ç”¨ç”¨æˆ· -mï¼‰â†’ å¯é€‰è¯„å®¡ â†’ git add/commit
- src/devops.rs
  - DevOps å®¢æˆ·ç«¯ï¼ˆCoding/GitHubï¼‰æ‹‰å– Issue ç®€è¦ä¿¡æ¯
- src/update/*
  - è‡ªåŠ¨æ›´æ–°å™¨ï¼šè§„åˆ™åŒ…ä¸‹è½½/è§£å‹/å…ƒä¿¡æ¯å†™å…¥ã€promptsï¼ˆå ä½ï¼‰ã€ç‰ˆæœ¬æ£€æŸ¥ä¸é€šçŸ¥
- src/ai.rs
  - AI è¯·æ±‚ï¼ˆOpenAI å…¼å®¹ï¼‰ï¼Œsystem+user åŒæ¶ˆæ¯ï¼Œæ”¯æŒ api_key/temperature

## 2. CLI å¥‘çº¦ï¼ˆæ ¸å¿ƒï¼‰

- gitai review
  - å…³é”®å¼€å…³ï¼š
    - --security-scanï¼ˆåœ¨è¯„å®¡è¿‡ç¨‹ä¸­è§¦å‘ OpenGrepï¼‰
    - --block-on-criticalï¼ˆError çº§åˆ«æ—¶éé›¶é€€å‡ºï¼‰
    - --tree-sitterï¼ˆå½“å‰æ–‡æ¡£å­˜åœ¨ï¼Œä½†å®ç°æœªæ¥å…¥ï¼›éœ€æ¢å¤ï¼‰
    - --format/--output
  - é»˜è®¤ä¸ç ´åï¼šæ— æ‰«æã€æ— é˜»æ–­ï¼Œçº¯æ–‡æœ¬è¾“å‡ºè‡³ stdout
- gitai scan
  - å…³é”®å¼€å…³ï¼š--langã€--no-historyã€--timeoutã€--formatã€--auto-installã€--update-rules
  - é»˜è®¤ï¼šä¸å†™å†å²ï¼ˆå·²æä¾› --no-history ä»¥ä¾¿åŸºå‡†ï¼‰ï¼ŒJSON è§£ææ•´å— results
- gitai commit
  - -m ä¸ AI äº’æ–¥ä¼˜å…ˆï¼šæœ‰ -m åˆ™æ ¼å¼åŒ–+æ‹¼æ¥ Issue å‰ç¼€ï¼›æ—  -m æ‰è°ƒç”¨ AI ç”Ÿæˆ
  - --review å¯åœ¨æäº¤å‰åšä¸€æ¬¡è¯„å®¡æ‘˜è¦ï¼ˆä¸é˜»æ–­ï¼‰
- gitai <git å­å‘½ä»¤>
  - é»˜è®¤ç›´é€šåŸç”Ÿè¾“å‡ºï¼›--ai æ—¶è¿½åŠ â€œğŸ¤– AIè§£é‡Šâ€ï¼›å¤±è´¥ä¿æŒéé›¶é€€å‡º
- gitai update / prompts
  - updateï¼šè§„åˆ™/æç¤ºè¯/ç‰ˆæœ¬æ£€æŸ¥ï¼›prompts çš„ update ä¸ºå ä½

## 3. æ•°æ®ä¸çŠ¶æ€

- é…ç½®ï¼š~/.config/gitai/config.toml
- è§„åˆ™ï¼š~/.cache/gitai/rulesï¼ˆé™„ .rules.metaï¼‰ã€è¯­è¨€å­ç›®å½•ï¼ˆjava/python/...ï¼‰
- æ‰«æå†å²ï¼š~/.cache/gitai/scan_history/scan_<tool>_<ts>.jsonï¼ˆå¯ç”¨ --no-history ç¦ç”¨ï¼‰
- è¯„å®¡ç¼“å­˜ï¼š~/.cache/gitai/review_cache/review_<cache_key>.json
- Promptsï¼š~/.config/gitai/prompts/*.mdï¼ˆinit æ—¶ç”Ÿæˆé»˜è®¤æ¨¡æ¿ï¼‰

## 4. å…³é”®æµç¨‹

- Review æµï¼š
  1) diff = git.get_all_diff()
  2) æš‚å­˜çŠ¶æ€æç¤ºï¼ˆéå¼ºåˆ¶ï¼‰
  3) cache_key = md5(diff + language + security_scan + deviation + issue_ids)
  4) è‹¥å‘½ä¸­ç¼“å­˜ â†’ è¾“å‡º â†’ ç»“æŸ
  5) issues = DevOps.get_issues(issue_ids)ï¼ˆå¯é€‰ï¼‰
  6) analysis = Analyzer.analyze(context)
     - review_result = AI æ–‡æœ¬
     - security_findings = run_opengrep_scanï¼ˆæŒ‰éœ€ï¼‰
     - deviation_analysis = AI æå–ï¼ˆæŒ‰éœ€ï¼‰
  7) ä¿å­˜ç¼“å­˜ + è¾“å‡º + ï¼ˆå¯é€‰é˜»æ–­ï¼‰

- Scan æµï¼š
  1) é€‰æ‹©è§„åˆ™ç›®å½•ï¼š--lang ä¼˜å…ˆï¼›å¦åˆ™è‡ªåŠ¨ç»Ÿè®¡ä¸»è¯­è¨€ â†’ å­ç›®å½•ï¼›ä¸å­˜åœ¨åˆ™å›é€€æ ¹ç›®å½•
  2) æ„å»º opengrep å‚æ•°ï¼ˆ--json/--quiet/--timeoutï¼‰+ å¯é€‰ --jobs
  3) æ‰§è¡Œå¹¶è§£æ results æ•°ç»„ â†’ å†™å†å²ï¼ˆå¯ç¦ç”¨ï¼‰â†’ è¾“å‡ºï¼ˆtext æˆ– jsonï¼‰

- Commit æµï¼š
  1) diff/issue ä¸Šä¸‹æ–‡ â†’ AI ç”Ÿæˆæˆ–ä½¿ç”¨ -m
  2) å¯é€‰è¯„å®¡æ‘˜è¦ï¼ˆä¸é˜»æ–­ï¼‰
  3) git add/commit

- Git ä»£ç†ï¼š
  1) è¿è¡ŒåŸç”Ÿå‘½ä»¤æ•è· stdout/stderr+é€€å‡ºç  â†’ ç›´é€š â†’ å¯é€‰ AI è§£é‡Š â†’ ä¿æŒé€€å‡ºç 

## 5. è¡Œä¸ºå¥‘çº¦ï¼ˆNever break userspaceï¼‰

- ä¸æ›¿æ¢ gitï¼Œä¹Ÿä¸é»˜è®¤æ”¹å†™è¾“å‡ºæˆ–é€€å‡ºç 
- æ‰€æœ‰å¢å¼ºï¼ˆAIè§£é‡Šã€é˜»æ–­ã€æ‰«æï¼‰å‡æ˜¾å¼å¼€å…³
- é”™è¯¯æ—¶ä¿ç•™åŸå§‹ stderrï¼Œå¹¶ä¿æŒéé›¶é€€å‡ºç 

## 6. æ€§èƒ½ä¸å¯ç”¨æ€§

- å°è£…å±‚å¯¹ opengrep çš„å¼€é”€ï¼š< 1sï¼ˆå½“å‰åŸºå‡†çº¦ 1.28x åŸç”Ÿï¼‰ï¼›æä¾› --lang/--no-history/--timeout/--benchmark ä»¥å¯¹é½æ¡ä»¶
- å¤æ‚å‘½ä»¤çš„åˆ†é¡µ/äº¤äº’é£é™©ï¼šç¦ç”¨ pager ä¿è¯éäº¤äº’è¾“å‡º

## 7. é£é™©ä¸å·²çŸ¥å·®å¼‚

- Treeâ€‘sitterï¼šCLI æœ‰å¼€å…³ï¼Œä½†æœªæ¥å…¥ Analyzerï¼›æ–‡æ¡£å­˜åœ¨è¶…å‰æè¿°
- Prompts.updateï¼šå ä½æœªå®ç°çœŸå®æº
- README ä¸å®ç°ç»†èŠ‚ï¼šå·²åšä¸€è½®å¯¹é½ï¼Œä½†ä»éœ€äºŒæ¬¡å®¡è§†ï¼ˆå°¤å…¶ Treeâ€‘sitter ç« èŠ‚ï¼‰

## 8. è®¾è®¡åŸåˆ™

- ç®€æ´ä¼˜å…ˆï¼šæœ€å°‘åˆ†æ”¯ã€æ˜ç¡®æ•°æ®æµ
- é…ç½®å¯é€‰ï¼Œçº¦å®šä¼˜äºé…ç½®ï¼›å‡ºç°é…ç½®ç¼ºå¤±æ—¶ç»™å‡ºæ¸…æ™°æç¤º
- ä¸å¼•å…¥äº¤äº’å¼ CLIï¼›ä¿æŒè„šæœ¬å‹å¥½

## 9. åç»­æ¼”è¿›ï¼ˆç®€è¿°ï¼‰

- æ¢å¤å¹¶æ¥å…¥ Treeâ€‘sitterï¼ˆæœ€å°å¯ç”¨ï¼šç»“æ„æ‘˜è¦æ³¨å…¥ promptï¼‰
- å®Œæˆ prompts.update çœŸå®æºåŒæ­¥ï¼ˆgit/URLï¼‰ï¼Œå«é‡è¯•ä¸æ ¡éªŒ
- åŠ  smoke tests ä¸åŸºå‡†ç« èŠ‚çš„è‡ªåŠ¨åŒ–è„šæœ¬

