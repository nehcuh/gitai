# è´¨é‡åº¦é‡ (Quality Metrics)

## åŠŸèƒ½æ¦‚è¿°

GitAI çš„è´¨é‡åº¦é‡åŠŸèƒ½æä¾›å…¨é¢çš„ä»£ç è´¨é‡è·Ÿè¸ªå’Œåˆ†æï¼Œå¸®åŠ©å›¢é˜Ÿç›‘æ§é¡¹ç›®å¥åº·çŠ¶æ€ã€è¯†åˆ«æŠ€æœ¯å€ºåŠ¡ã€è·Ÿè¸ªè´¨é‡è¶‹åŠ¿ï¼Œå¹¶ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Šã€‚

## æ ¸å¿ƒç‰¹æ€§

### 1. å¤šç»´åº¦åº¦é‡
- **ä»£ç å¤æ‚åº¦**ï¼šåœˆå¤æ‚åº¦ã€è®¤çŸ¥å¤æ‚åº¦
- **ä»£ç è¦†ç›–ç‡**ï¼šæµ‹è¯•è¦†ç›–ç‡ã€åˆ†æ”¯è¦†ç›–ç‡
- **æŠ€æœ¯å€ºåŠ¡**ï¼šå€ºåŠ¡æ¯”ç‡ã€ä¿®å¤æ—¶é—´ä¼°ç®—
- **ä»£ç é‡å¤**ï¼šé‡å¤ç‡ã€å…‹éš†å—æ£€æµ‹
- **ä¾èµ–å¥åº·**ï¼šè¿‡æ—¶ä¾èµ–ã€å®‰å…¨æ¼æ´
- **æ¶æ„è´¨é‡**ï¼šæ¨¡å—è€¦åˆåº¦ã€å†…èšæ€§

### 2. è¶‹åŠ¿åˆ†æ
- å†å²æ•°æ®å¯¹æ¯”
- è´¨é‡è¶‹åŠ¿å›¾è¡¨
- é¢„è­¦å’Œé˜ˆå€¼
- æ”¹è¿›å»ºè®®

### 3. æŠ¥å‘Šç”Ÿæˆ
- HTML å¯è§†åŒ–æŠ¥å‘Š
- JSON æ•°æ®å¯¼å‡º
- CSV è¡¨æ ¼å¯¼å‡º
- Markdown æ–‡æ¡£

### 4. é›†æˆèƒ½åŠ›
- CI/CD é›†æˆ
- Git hooks
- IDE æ’ä»¶
- Dashboard API

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# è®°å½•å½“å‰è´¨é‡å¿«ç…§
gitai metrics record

# åˆ†æè´¨é‡è¶‹åŠ¿ï¼ˆæœ€è¿‘30å¤©ï¼‰
gitai metrics analyze --days 30

# ç”Ÿæˆè´¨é‡æŠ¥å‘Š
gitai metrics report

# å¯¼å‡ºæ•°æ®
gitai metrics export --format json

# æ¯”è¾ƒä¸¤ä¸ªå¿«ç…§
gitai metrics compare --from 2024-01-01 --to 2024-01-31

# åˆ—å‡ºæ‰€æœ‰å¿«ç…§
gitai metrics list
```

### é«˜çº§ç”¨æ³•

```bash
# è®°å½•ç‰¹å®šç±»å‹çš„åº¦é‡
gitai metrics record --type complexity,coverage,security

# ç”Ÿæˆ HTML æŠ¥å‘Š
gitai metrics report --format html --output report.html

# è®¾ç½®è´¨é‡é˜ˆå€¼
gitai metrics analyze --threshold-complexity 10 --threshold-coverage 80

# æ¸…ç†æ—§æ•°æ®
gitai metrics clean --older-than 90

# å¯¼å…¥å¤–éƒ¨åº¦é‡æ•°æ®
gitai metrics import --source sonarqube --file metrics.json
```

## é…ç½®é€‰é¡¹

åœ¨ `~/.config/gitai/config.toml` ä¸­é…ç½®ï¼š

```toml
[metrics]
# è‡ªåŠ¨è®°å½•é—´éš”ï¼ˆå°æ—¶ï¼‰
auto_record_interval = 24

# æ•°æ®ä¿ç•™æœŸé™ï¼ˆå¤©ï¼‰
retention_days = 90

# é»˜è®¤åˆ†æå¤©æ•°
default_analysis_days = 30

[metrics.thresholds]
# è´¨é‡é˜ˆå€¼
max_complexity = 10
min_coverage = 80
max_duplication = 5
max_tech_debt_ratio = 5

[metrics.types]
# å¯ç”¨çš„åº¦é‡ç±»å‹
enabled = [
    "complexity",
    "coverage",
    "duplication",
    "security",
    "dependencies",
    "architecture"
]

[metrics.report]
# æŠ¥å‘Šé…ç½®
default_format = "html"
include_charts = true
include_recommendations = true
```

## åº¦é‡æŒ‡æ ‡è¯¦è§£

### 1. ä»£ç å¤æ‚åº¦

**åœˆå¤æ‚åº¦ (Cyclomatic Complexity)**
- è¡¡é‡ä»£ç ä¸­ç‹¬ç«‹è·¯å¾„çš„æ•°é‡
- å»ºè®®å€¼ï¼šâ‰¤ 10
- è®¡ç®—å…¬å¼ï¼šM = E - N + 2P

**è®¤çŸ¥å¤æ‚åº¦ (Cognitive Complexity)**
- è¡¡é‡ä»£ç ç†è§£éš¾åº¦
- è€ƒè™‘åµŒå¥—æ·±åº¦å’Œæ§åˆ¶æµ
- å»ºè®®å€¼ï¼šâ‰¤ 15

### 2. æµ‹è¯•è¦†ç›–ç‡

**è¡Œè¦†ç›–ç‡**
- è¢«æµ‹è¯•æ‰§è¡Œçš„ä»£ç è¡Œç™¾åˆ†æ¯”
- ç›®æ ‡å€¼ï¼šâ‰¥ 80%

**åˆ†æ”¯è¦†ç›–ç‡**
- è¢«æµ‹è¯•çš„æ¡ä»¶åˆ†æ”¯ç™¾åˆ†æ¯”
- ç›®æ ‡å€¼ï¼šâ‰¥ 70%

### 3. ä»£ç é‡å¤

**é‡å¤ç‡**
- é‡å¤ä»£ç å æ€»ä»£ç çš„ç™¾åˆ†æ¯”
- ç›®æ ‡å€¼ï¼š< 5%

**å…‹éš†ç±»å‹**
- Type-1ï¼šå®Œå…¨ç›¸åŒ
- Type-2ï¼šå‚æ•°åŒ–ç›¸åŒ
- Type-3ï¼šç»“æ„ç›¸ä¼¼

### 4. æŠ€æœ¯å€ºåŠ¡

**å€ºåŠ¡æ¯”ç‡**
- ä¿®å¤æˆæœ¬ / å¼€å‘æˆæœ¬
- ç›®æ ‡å€¼ï¼š< 5%

**å€ºåŠ¡åˆ†ç±»**
- ğŸ”´ **é˜»å¡**ï¼šå¿…é¡»ç«‹å³ä¿®å¤
- ğŸŸ¡ **å…³é”®**ï¼šçŸ­æœŸå†…ä¿®å¤
- ğŸ”µ **ä¸»è¦**ï¼šè®¡åˆ’ä¿®å¤
- âšª **æ¬¡è¦**ï¼šå¯é€‰ä¿®å¤

## å·¥ä½œæµç¨‹

### 1. æ•°æ®é‡‡é›†
```
ä»£ç æ‰«æ â†’ åº¦é‡è®¡ç®— â†’ æ•°æ®èšåˆ â†’ å¿«ç…§ä¿å­˜
```

### 2. è¶‹åŠ¿åˆ†æ
```
å†å²æ•°æ®åŠ è½½ â†’ æ—¶é—´åºåˆ—åˆ†æ â†’ è¶‹åŠ¿è¯†åˆ« â†’ é¢„è­¦ç”Ÿæˆ
```

### 3. æŠ¥å‘Šç”Ÿæˆ
```
æ•°æ®æŸ¥è¯¢ â†’ å›¾è¡¨ç”Ÿæˆ â†’ æ¨¡æ¿æ¸²æŸ“ â†’ æŠ¥å‘Šè¾“å‡º
```

## ç¤ºä¾‹åœºæ™¯

### åœºæ™¯ 1ï¼šæ¯æ—¥è´¨é‡è·Ÿè¸ª

```bash
# æ¯å¤©æ—©ä¸Šè®°å½•è´¨é‡å¿«ç…§
gitai metrics record

# è¾“å‡ºç¤ºä¾‹ï¼š
ğŸ“Š æ­£åœ¨åˆ†æä»£ç è´¨é‡...
âœ… è´¨é‡å¿«ç…§å·²è®°å½•

è´¨é‡æ¦‚è§ˆï¼š
- ä»£ç è¡Œæ•°ï¼š45,678
- åœˆå¤æ‚åº¦ï¼šå¹³å‡ 6.5ï¼ˆè‰¯å¥½ï¼‰
- æµ‹è¯•è¦†ç›–ç‡ï¼š82.3%ï¼ˆä¼˜ç§€ï¼‰
- ä»£ç é‡å¤ç‡ï¼š3.2%ï¼ˆè‰¯å¥½ï¼‰
- æŠ€æœ¯å€ºåŠ¡ï¼š2.1%ï¼ˆä½ï¼‰
- å®‰å…¨é—®é¢˜ï¼š0 ä¸ªé«˜å±ï¼Œ2 ä¸ªä¸­å±

ä¸æ˜¨å¤©ç›¸æ¯”ï¼š
- è¦†ç›–ç‡ +1.2% â†‘
- å¤æ‚åº¦ -0.3 â†“
- æŠ€æœ¯å€ºåŠ¡ -0.1% â†“

æ•´ä½“è´¨é‡ï¼šA çº§ï¼ˆä¼˜ç§€ï¼‰
```

### åœºæ™¯ 2ï¼šæœˆåº¦è´¨é‡æŠ¥å‘Š

```bash
gitai metrics report --format html --days 30

# è¾“å‡ºç¤ºä¾‹ï¼š
ğŸ“ˆ ç”Ÿæˆæœˆåº¦è´¨é‡æŠ¥å‘Š...
âœ… æŠ¥å‘Šå·²ç”Ÿæˆï¼šquality-report-2024-01.html

æŠ¥å‘Šæ‘˜è¦ï¼š
- åˆ†æå‘¨æœŸï¼š2024-01-01 è‡³ 2024-01-31
- è´¨é‡è¶‹åŠ¿ï¼šç¨³æ­¥æ”¹å–„
- å…³é”®æˆå°±ï¼š
  * æµ‹è¯•è¦†ç›–ç‡æå‡ 5%
  * æ¶ˆé™¤ 3 ä¸ªé«˜å¤æ‚åº¦æ¨¡å—
  * ä¿®å¤ 15 ä¸ªå®‰å…¨é—®é¢˜
- éœ€è¦å…³æ³¨ï¼š
  * src/parser æ¨¡å—å¤æ‚åº¦åé«˜
  * ä¾èµ–åŒ… lodash å­˜åœ¨å®‰å…¨æ¼æ´
  * ä»£ç é‡å¤ç‡æœ‰ä¸Šå‡è¶‹åŠ¿
```

### åœºæ™¯ 3ï¼šCI/CD è´¨é‡é—¨ç¦

```yaml
# .github/workflows/quality.yml
name: Quality Gate

on: [push, pull_request]

jobs:
  quality-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Install GitAI
        run: cargo install gitai
      
      - name: Record Metrics
        run: gitai metrics record
      
      - name: Check Quality Gates
        run: |
          gitai metrics analyze --threshold-complexity 10 \
                              --threshold-coverage 80 \
                              --threshold-duplication 5
      
      - name: Upload Report
        if: always()
        uses: actions/upload-artifact@v2
        with:
          name: quality-report
          path: metrics-report.html
```

## å¯è§†åŒ–æŠ¥å‘Š

### HTML æŠ¥å‘Šå†…å®¹

1. **æ‰§è¡Œæ‘˜è¦**
   - è´¨é‡è¯„çº§ï¼ˆA-Fï¼‰
   - å…³é”®æŒ‡æ ‡ä»ªè¡¨ç›˜
   - è¶‹åŠ¿ç®­å¤´

2. **è¯¦ç»†åˆ†æ**
   - å¤æ‚åº¦çƒ­å›¾
   - è¦†ç›–ç‡åˆ†å¸ƒ
   - æŠ€æœ¯å€ºåŠ¡æ¸…å•

3. **è¶‹åŠ¿å›¾è¡¨**
   - æ—¶é—´åºåˆ—å›¾
   - å¯¹æ¯”æŸ±çŠ¶å›¾
   - é¥¼å›¾åˆ†å¸ƒ

4. **æ”¹è¿›å»ºè®®**
   - ä¼˜å…ˆçº§åˆ—è¡¨
   - ä¼°ç®—å·¥ä½œé‡
   - æœ€ä½³å®è·µ

### ç¤ºä¾‹æŠ¥å‘Šç»“æ„

```html
<!DOCTYPE html>
<html>
<head>
    <title>GitAI è´¨é‡æŠ¥å‘Š</title>
    <style>
        /* ç¾è§‚çš„æ ·å¼ */
    </style>
</head>
<body>
    <h1>é¡¹ç›®è´¨é‡æŠ¥å‘Š</h1>
    
    <section class="summary">
        <div class="grade">A</div>
        <div class="metrics">
            <div class="metric">
                <span>å¤æ‚åº¦</span>
                <span>6.5</span>
            </div>
            <!-- æ›´å¤šæŒ‡æ ‡ -->
        </div>
    </section>
    
    <section class="trends">
        <canvas id="trend-chart"></canvas>
    </section>
    
    <section class="recommendations">
        <ul>
            <li>é™ä½ parser.rs çš„å¤æ‚åº¦</li>
            <li>å¢åŠ  auth æ¨¡å—çš„æµ‹è¯•è¦†ç›–</li>
        </ul>
    </section>
</body>
</html>
```

## æ•°æ®å¯¼å‡ºæ ¼å¼

### JSON æ ¼å¼

```json
{
  "timestamp": "2024-01-31T10:00:00Z",
  "project": "gitai",
  "metrics": {
    "complexity": {
      "average": 6.5,
      "max": 23,
      "distribution": {
        "low": 78,
        "medium": 18,
        "high": 4
      }
    },
    "coverage": {
      "line": 82.3,
      "branch": 75.6,
      "function": 88.9
    },
    "duplication": {
      "percentage": 3.2,
      "blocks": 15
    }
  },
  "trends": {
    "complexity": -0.3,
    "coverage": +1.2,
    "duplication": +0.1
  }
}
```

### CSV æ ¼å¼

```csv
Date,Complexity,Coverage,Duplication,TechDebt,Security
2024-01-01,6.8,81.1,3.1,2.2,3
2024-01-02,6.7,81.5,3.1,2.1,2
2024-01-03,6.5,82.3,3.2,2.1,0
```

## ä¸å…¶ä»–åŠŸèƒ½é›†æˆ

### ä»£ç è¯„å®¡é›†æˆ

```bash
# è¯„å®¡æ—¶åŒ…å«è´¨é‡åº¦é‡
gitai review --with-metrics
```

### æäº¤æ—¶è®°å½•

```bash
# æäº¤åè‡ªåŠ¨è®°å½•åº¦é‡
gitai commit && gitai metrics record
```

### æ‰«æé›†æˆ

```bash
# å®‰å…¨æ‰«æåæ›´æ–°åº¦é‡
gitai scan && gitai metrics record --type security
```

## æ•…éšœæ’é™¤

### é—®é¢˜ï¼šåº¦é‡æ•°æ®ä¸å‡†ç¡®

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®ä¿ä»£ç å·²å®Œå…¨æ„å»º
2. è¿è¡Œæµ‹è¯•ç”Ÿæˆè¦†ç›–ç‡æ•°æ®
3. æ£€æŸ¥é…ç½®çš„åº¦é‡å·¥å…·
4. æ¸…ç†ç¼“å­˜é‡æ–°è®¡ç®—

### é—®é¢˜ï¼šæŠ¥å‘Šç”Ÿæˆå¤±è´¥

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥æ•°æ®ç›®å½•æƒé™
2. ç¡®ä¿æœ‰è¶³å¤Ÿçš„å†å²æ•°æ®
3. éªŒè¯æ¨¡æ¿æ–‡ä»¶å®Œæ•´
4. æŸ¥çœ‹é”™è¯¯æ—¥å¿—

### é—®é¢˜ï¼šè¶‹åŠ¿åˆ†æå¼‚å¸¸

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥æ—¶é—´èŒƒå›´è®¾ç½®
2. éªŒè¯æ•°æ®è¿ç»­æ€§
3. æ’é™¤å¼‚å¸¸æ•°æ®ç‚¹
4. é‡æ–°è®¡ç®—åŸºçº¿

## æœ€ä½³å®è·µ

### 1. å®šæœŸè®°å½•
- æ¯æ—¥è‡ªåŠ¨è®°å½•
- é‡è¦ç‰ˆæœ¬å‰åè®°å½•
- ä»£ç å®¡æŸ¥åè®°å½•

### 2. è®¾ç½®åˆç†é˜ˆå€¼
- æ ¹æ®é¡¹ç›®ç‰¹ç‚¹è°ƒæ•´
- é€æ­¥æé«˜æ ‡å‡†
- åŒºåˆ†å…³é”®å’Œéå…³é”®ä»£ç 

### 3. è¡ŒåŠ¨è·Ÿè¿›
- å®šæœŸå®¡æŸ¥æŠ¥å‘Š
- åˆ¶å®šæ”¹è¿›è®¡åˆ’
- è·Ÿè¸ªæ”¹è¿›æ•ˆæœ

### 4. å›¢é˜Ÿåä½œ
- å…±äº«è´¨é‡ç›®æ ‡
- å®šæœŸè´¨é‡å›é¡¾
- åº†ç¥è´¨é‡æ”¹è¿›

## é«˜çº§åŠŸèƒ½

### è‡ªå®šä¹‰åº¦é‡

```rust
// å®ç°è‡ªå®šä¹‰åº¦é‡
pub struct CustomMetric {
    name: String,
    calculate: Box<dyn Fn(&CodeBase) -> f64>,
}

impl CustomMetric {
    pub fn new(name: &str, calculator: impl Fn(&CodeBase) -> f64 + 'static) -> Self {
        Self {
            name: name.to_string(),
            calculate: Box::new(calculator),
        }
    }
}
```

### åº¦é‡æ’ä»¶

```toml
# é…ç½®æ’ä»¶
[metrics.plugins]
enabled = ["sonarqube", "codecov", "custom"]

[metrics.plugins.sonarqube]
url = "https://sonar.example.com"
token = "xxx"
```

## æœªæ¥å±•æœ›

- [ ] å®æ—¶åº¦é‡ç›‘æ§
- [ ] AI é©±åŠ¨çš„è´¨é‡é¢„æµ‹
- [ ] è‡ªåŠ¨åŒ–è´¨é‡æ”¹è¿›å»ºè®®
- [ ] å›¢é˜Ÿç»©æ•ˆä»ªè¡¨æ¿
- [ ] è·¨é¡¹ç›®è´¨é‡å¯¹æ¯”
